# Changelog v1.0.4 - Audio System & New Architecture

**🔗 Lien de test Android**: https://play.google.com/apps/internaltest/4701499537445297168

## 🎯 Audio System (CRITICAL PATH - Score 5.0) ✅

### Implémentations
1. **setAudioModeAsync Configuration** ✅
   - `playsInSilentMode: true` - Son joue TOUJOURS même en mode silencieux
   - `shouldPlayInBackground: true` - Son joue même app en arrière-plan
   - `interruptionMode: 'duckOthers'` - Baisse volume autres apps au lieu de couper

2. **iOS Background Audio** ✅
   - `UIBackgroundModes: ["audio"]` ajouté dans app.json
   - Session audio reste active en arrière-plan

3. **Feedback Synchronisé** ✅
   - Audio + Haptic via `Promise.all()`
   - Priorité à l'audio (fail silently sur haptic)

4. **Architecture Extensible** ✅
   - Hook `useEnhancedAudio` préparé pour sons multiples
   - Structure prête pour v1.0.5+

### Tests Critiques ✅ VALIDÉS
- [x] Mode silencieux → Son joue ✅
- [x] App arrière-plan → Son joue ✅
- [x] Silencieux + arrière-plan → Son joue ✅
- [x] Ducking avec musique → Baisse volume correctement ✅

### Impact Utilisateur
- **100% consensus famille** : "Le son doit jouer même téléphone silencieux"
- **Santi** : "Pouvoir entendre la fin même si j'ai mis l'app de côté"
- **Maman** : "Je mets toujours mon téléphone en silencieux"

## 🎨 UX Flow Améliorations (Score 3.9-4.6)

### Onboarding System v2.0 (Score 4.2) ✅
- **Wizard interactif** avec tooltips séquentiels guidés
- Spotlight SVG avec masque professionnel (coins arrondis)
- **Système pleinement interactif** pendant l'onboarding
- Positionnement intelligent des bulles (auto-détection espace)
- Séquence optimisée: Activities → Dial → Palette → Controls
- Auto-complétion quand l'utilisateur démarre le timer
- "Skip all" avec état de complétion persistant
- Relançable via "Relancer le guide" dans Paramètres

### Interface Optimisée ✅
- **Durée par défaut 45min** (sessions Pomodoro optimisées)
- **Paramètres redesignés** avec hiérarchie visuelle claire (iOS 15+)
  - 3 niveaux: Core Experience → Configuration → Informations
  - Cards avec surface, coins arrondis, ombres subtiles
- **Effet de lueur au démarrage** du timer (feedback discret 600ms)
- **Carrousel de couleurs** : bordures des pastilles sélectionnées parfaitement visibles
- **Chargeur circulaire iOS** lors de l'aperçu des sons
- Tap area agrandie pour bouton fermer (44x44px iOS minimum)

## 🐛 Foundation - Corrections Critiques

### Bugs Système ✅
- 🌓 **Mode système entièrement fonctionnel** (`Appearance` API au lieu de `useColorScheme`)
- 🔔 **Crashs notifications** en arrière-plan résolus (try-catch + config plugin)
- 🔧 **Configuration haptic feedback** pour production builds
- ⚙️ **Cycle des thèmes** corrigé (light → dark → auto → light)
- 🎨 `theme.colors.primary` → `theme.colors.brand.primary` (références corrigées)
- 🎨 Ajout de `textLight` manquant dans les thèmes

### Tests & Validation ✅
- 29/29 tests unitaires passent
- 4 scénarios audio critiques testés et validés
- Fix mock `useSimpleAudio` (remplace `useAudio` legacy)
- Fix mock `TimerOptionsContext` pour tests isolés

## 🚀 Foundation Technique (Learning Value 5.0)

### Migration SDK 54 + New Architecture ✅
**Future-proof** - Préparation pour MoodCycle
- **React Native 0.81.5** avec New Architecture activée
- **React 19.0.0** migration complète
- **compileSdk 36**, targetSdk 36, minSdk 24
- **Gradle memory**: 4GB heap / 1GB metaspace (requis New Arch)
- **Architecture modulaire** extensible
- **AAB size**: 61MB (toutes architectures natives)
- **Build time**: ~5-7 minutes

### Documentation Industrielle ✅
- `ANDROID_BUILD_CONFIG.md` mis à jour pour SDK 54
- Process de build documenté (prebuild, signing, gradle)
- Credentials et keystore management
- Troubleshooting OutOfMemoryError

## 🔔 Prochaine étape v1.1.0 : Laboratoire Technique
### PHASE 1: Monétisation (Learning Value 4.5-4.8)
- RevenueCat Setup (tech critique pour MoodCycle)
- Purchase Flow iOS (processus commercial essentiel)
- Premium Logic (architecture freemium réutilisable)

### PHASE 2: Lock Screen Display (Score 4.3)
- expo-notifications pour voir le timer écran verrouillé
- Countdown en temps réel
- 6-8h d'effort estimé

## 📊 Progression v1.0.4 - RELEASE COMPLÈTE ✅

### Développement (26h)
- [x] Audio System (4h) ✅
- [x] SDK 54 Migration (8h) ✅
- [x] New Architecture (6h) ✅
- [x] Onboarding System v2.0 (3h) ✅
- [x] Testing Foundation (3h) ✅
- [x] Architecture Modulaire (2h) ✅

### Déploiement ✅
- [x] Build Android 1.0.4 (versionCode 10) ✅
- [x] AAB signé et prêt (61MB) ✅
- [x] Tests internes publiés sur Play Console ✅
- [x] Documentation technique à jour ✅

**Total réalisé : 26h - v1.0.4 DÉPLOYÉE**

### 🔗 Liens de Test
- **Android Internal Testing**: https://play.google.com/apps/internaltest/4701499537445297168
- **iOS TestFlight**: https://appstoreconnect.apple.com/apps/6752913010/testflight/ios (buildNumber 13)

### Prochaine version v1.1.0 - Laboratoire Technique
- [ ] RevenueCat Setup (4-5h) - PHASE 1 Monétisation
- [ ] Purchase Flow iOS (3-4h) - PHASE 1 Monétisation
- [ ] Lock Screen Display (6-8h) - PHASE 2
- [ ] Internationalisation 15 langues (10-12h) - PHASE 3
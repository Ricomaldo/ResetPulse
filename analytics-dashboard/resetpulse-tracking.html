<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ResetPulse - Tracking Quotidien</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      padding: 24px;
      min-height: 100vh;
    }
    h1 {
      color: #00d9ff;
      font-size: 24px;
      margin-bottom: 8px;
    }
    .subtitle {
      color: #888;
      font-size: 14px;
      margin-bottom: 24px;
    }
    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      background: #1e2746;
      padding: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th {
      background: #2d3a5a;
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
      color: #00d9ff;
      border-bottom: 2px solid #00d9ff33;
    }
    th.platform-ios { background: #3a2d5a; color: #bf5af2; }
    th.platform-android { background: #2d5a3a; color: #30d158; }
    th.shared { background: #5a4a2d; color: #ffd60a; }
    td {
      padding: 10px 8px;
      text-align: center;
      border-bottom: 1px solid #ffffff11;
    }
    tr:hover { background: #ffffff08; }
    .date { 
      font-weight: 600; 
      color: #fff;
      text-align: left;
      padding-left: 12px;
    }
    .ios { background: #bf5af215; }
    .android { background: #30d15815; }
    .shared { background: #ffd60a15; }
    .good { color: #30d158; }
    .warning { color: #ffd60a; }
    .bad { color: #ff453a; }
    .neutral { color: #aaa; }
    
    .legend {
      margin-top: 24px;
      padding: 16px;
      background: #1e2746;
      border-radius: 12px;
    }
    .legend h3 {
      color: #00d9ff;
      font-size: 14px;
      margin-bottom: 12px;
    }
    .legend-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 8px;
    }
    .legend-item {
      display: flex;
      gap: 8px;
      font-size: 12px;
      color: #ccc;
    }
    .legend-item strong {
      color: #fff;
      min-width: 100px;
    }
    .legend-item .source {
      color: #00d9ff;
      font-family: monospace;
      font-size: 11px;
    }
    
    .summary {
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }
    .summary-card {
      background: #1e2746;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
    .summary-card .value {
      font-size: 28px;
      font-weight: 700;
    }
    .summary-card .label {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }

    /* Interactive styles */
    .toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .toolbar button {
      background: #2d3a5a;
      border: none;
      color: #00d9ff;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
    }
    .toolbar button:hover {
      background: #3d4a6a;
    }
    tbody td {
      cursor: pointer;
      transition: background 0.15s;
    }
    tbody td:hover {
      background: #ffffff20 !important;
    }
    tbody td input {
      width: 100%;
      background: transparent;
      border: 1px solid #00d9ff;
      border-radius: 4px;
      color: inherit;
      text-align: center;
      font-size: inherit;
      padding: 4px;
      outline: none;
    }
    tbody td.date input {
      text-align: left;
    }
    .actions {
      opacity: 0;
      transition: opacity 0.2s;
      width: 40px;
    }
    tr:hover .actions {
      opacity: 1;
    }
    .actions button {
      background: #ff453a;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      padding: 4px 10px;
      font-size: 14px;
    }
    .actions button:hover {
      background: #ff6b61;
    }
    th.actions-header {
      background: transparent;
      width: 40px;
    }
  </style>
</head>
<body>

  <h1>üìä ResetPulse - Tracking Quotidien</h1>
  <p class="subtitle">Semaine du 2 d√©cembre 2025</p>

  <div class="toolbar">
    <button onclick="addRow()">+ Ajouter une ligne</button>
    <button onclick="exportJSON()">Export JSON</button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th rowspan="2">Date</th>
          <th colspan="4" class="platform-ios">üçé iOS</th>
          <th colspan="4" class="platform-android">ü§ñ Android</th>
          <th colspan="3" class="shared">üìà Mixpanel + RevenueCat</th>
          <th rowspan="2" class="actions-header"></th>
        </tr>
        <tr>
          <!-- iOS -->
          <th class="platform-ios">Impr.</th>
          <th class="platform-ios">Vues</th>
          <th class="platform-ios">DL</th>
          <th class="platform-ios">‚≠ê</th>
          <!-- Android -->
          <th class="platform-android">Impr.</th>
          <th class="platform-android">Vues</th>
          <th class="platform-android">DL</th>
          <th class="platform-android">‚≠ê</th>
          <!-- Shared -->
          <th class="shared">PW‚ÜíTrial</th>
          <th class="shared">Trial‚ÜíPaid</th>
          <th class="shared">Revenue</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="date">Lun 02/12</td>
          <!-- iOS -->
          <td class="ios neutral">45</td>
          <td class="ios neutral">12</td>
          <td class="ios neutral">2</td>
          <td class="ios neutral">0</td>
          <!-- Android -->
          <td class="android neutral">120</td>
          <td class="android neutral">38</td>
          <td class="android good">5</td>
          <td class="android good">1</td>
          <!-- Shared -->
          <td class="shared bad">5.7%</td>
          <td class="shared good">100%</td>
          <td class="shared">‚Ç¨4.99</td>
        </tr>
        <tr>
          <td class="date">Mar 03/12</td>
          <!-- iOS -->
          <td class="ios neutral">52</td>
          <td class="ios neutral">14</td>
          <td class="ios neutral">1</td>
          <td class="ios neutral">0</td>
          <!-- Android -->
          <td class="android neutral">98</td>
          <td class="android neutral">29</td>
          <td class="android neutral">3</td>
          <td class="android neutral">0</td>
          <!-- Shared -->
          <td class="shared bad">6.2%</td>
          <td class="shared good">100%</td>
          <td class="shared">‚Ç¨0</td>
        </tr>
        <tr>
          <td class="date">Mer 04/12</td>
          <!-- iOS -->
          <td class="ios neutral">41</td>
          <td class="ios neutral">9</td>
          <td class="ios neutral">1</td>
          <td class="ios good">1</td>
          <!-- Android -->
          <td class="android neutral">85</td>
          <td class="android neutral">22</td>
          <td class="android neutral">2</td>
          <td class="android neutral">0</td>
          <!-- Shared -->
          <td class="shared warning">8.1%</td>
          <td class="shared good">100%</td>
          <td class="shared">‚Ç¨0</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Summary Cards -->
  <div class="summary">
    <div class="summary-card">
      <div class="value" style="color: #bf5af2;">4</div>
      <div class="label">Downloads iOS (3j)</div>
    </div>
    <div class="summary-card">
      <div class="value" style="color: #30d158;">10</div>
      <div class="label">Downloads Android (3j)</div>
    </div>
    <div class="summary-card">
      <div class="value" style="color: #ffd60a;">6.7%</div>
      <div class="label">PW‚ÜíTrial moyen</div>
    </div>
    <div class="summary-card">
      <div class="value" style="color: #00d9ff;">‚Ç¨4.99</div>
      <div class="label">Revenue total (3j)</div>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend">
    <h3>üìç O√π trouver chaque donn√©e</h3>
    <div class="legend-grid">
      <div class="legend-item">
        <strong>Impr. iOS</strong>
        <span>App Store Connect ‚Üí <span class="source">Analytics ‚Üí Impressions</span></span>
      </div>
      <div class="legend-item">
        <strong>Vues iOS</strong>
        <span>App Store Connect ‚Üí <span class="source">Analytics ‚Üí Product Page Views</span></span>
      </div>
      <div class="legend-item">
        <strong>DL iOS</strong>
        <span>App Store Connect ‚Üí <span class="source">Analytics ‚Üí Downloads</span></span>
      </div>
      <div class="legend-item">
        <strong>‚≠ê iOS</strong>
        <span>App Store Connect ‚Üí <span class="source">Ratings & Reviews</span></span>
      </div>
      <div class="legend-item">
        <strong>Impr. Android</strong>
        <span>Play Console ‚Üí <span class="source">Statistics ‚Üí Store listing visitors</span></span>
      </div>
      <div class="legend-item">
        <strong>Vues Android</strong>
        <span>Play Console ‚Üí <span class="source">Statistics ‚Üí Store listing visitors (detailed)</span></span>
      </div>
      <div class="legend-item">
        <strong>DL Android</strong>
        <span>Play Console ‚Üí <span class="source">Statistics ‚Üí Installs</span></span>
      </div>
      <div class="legend-item">
        <strong>‚≠ê Android</strong>
        <span>Play Console ‚Üí <span class="source">Ratings & Reviews</span></span>
      </div>
      <div class="legend-item">
        <strong>PW‚ÜíTrial</strong>
        <span>Mixpanel ‚Üí <span class="source">Board "ResetPulse Conversions"</span></span>
      </div>
      <div class="legend-item">
        <strong>Trial‚ÜíPaid</strong>
        <span>Mixpanel ‚Üí <span class="source">Board "ResetPulse Conversions"</span></span>
      </div>
      <div class="legend-item">
        <strong>Revenue</strong>
        <span>RevenueCat ‚Üí <span class="source">Overview ‚Üí Revenue</span></span>
      </div>
    </div>
  </div>

<script>
// === CONFIG ===
const STORAGE_KEY = 'resetpulse-tracking';
const COLUMNS = [
  { key: 'date', class: 'date' },
  { key: 'ios_impr', class: 'ios' },
  { key: 'ios_vues', class: 'ios' },
  { key: 'ios_dl', class: 'ios' },
  { key: 'ios_stars', class: 'ios' },
  { key: 'android_impr', class: 'android' },
  { key: 'android_vues', class: 'android' },
  { key: 'android_dl', class: 'android' },
  { key: 'android_stars', class: 'android' },
  { key: 'pw_trial', class: 'shared' },
  { key: 'trial_paid', class: 'shared' },
  { key: 'revenue', class: 'shared' }
];

// === DATA ===
let data = loadData() || parseExistingTable();

// === DOM ===
const tbody = document.querySelector('tbody');
const table = document.querySelector('table');

// === INIT ===
render();

// === RENDER ===
function render() {
  tbody.innerHTML = data.map((row, i) => `
    <tr>
      ${COLUMNS.map(col => `<td class="${col.class}" data-row="${i}" data-col="${col.key}">${row[col.key]}</td>`).join('')}
      <td class="actions"><button onclick="deleteRow(${i})">√ó</button></td>
    </tr>
  `).join('');
  updateSummary();
}

// === EVENTS ===
table.addEventListener('dblclick', e => {
  const td = e.target.closest('td');
  if (td && td.dataset.col && !td.querySelector('input')) {
    startEdit(td);
  }
});

function startEdit(td) {
  const value = td.textContent;
  const input = document.createElement('input');
  input.value = value;
  td.textContent = '';
  td.appendChild(input);
  input.focus();
  input.select();

  input.onblur = () => saveEdit(td, input);
  input.onkeydown = e => {
    if (e.key === 'Enter') input.blur();
    if (e.key === 'Escape') {
      td.textContent = value;
    }
  };
}

function saveEdit(td, input) {
  const { row, col } = td.dataset;
  data[row][col] = input.value;
  save();
  render();
}

// === CRUD ===
function addRow() {
  const days = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
  const now = new Date();
  const dateStr = `${days[now.getDay()]} ${String(now.getDate()).padStart(2,'0')}/${String(now.getMonth()+1).padStart(2,'0')}`;

  data.push({
    date: dateStr,
    ios_impr: 0, ios_vues: 0, ios_dl: 0, ios_stars: 0,
    android_impr: 0, android_vues: 0, android_dl: 0, android_stars: 0,
    pw_trial: '0%', trial_paid: '0%', revenue: '‚Ç¨0'
  });
  save();
  render();
}

function deleteRow(index) {
  if (confirm('Supprimer cette ligne ?')) {
    data.splice(index, 1);
    save();
    render();
  }
}

// === PERSISTENCE ===
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function loadData() {
  const stored = localStorage.getItem(STORAGE_KEY);
  return stored ? JSON.parse(stored) : null;
}

function parseExistingTable() {
  const rows = [];
  tbody.querySelectorAll('tr').forEach(tr => {
    const tds = tr.querySelectorAll('td');
    if (tds.length >= 12) {
      rows.push({
        date: tds[0].textContent,
        ios_impr: tds[1].textContent,
        ios_vues: tds[2].textContent,
        ios_dl: tds[3].textContent,
        ios_stars: tds[4].textContent,
        android_impr: tds[5].textContent,
        android_vues: tds[6].textContent,
        android_dl: tds[7].textContent,
        android_stars: tds[8].textContent,
        pw_trial: tds[9].textContent,
        trial_paid: tds[10].textContent,
        revenue: tds[11].textContent
      });
    }
  });
  return rows;
}

// === EXPORT ===
function exportJSON() {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `resetpulse-tracking-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// === SUMMARY ===
function updateSummary() {
  const cards = document.querySelectorAll('.summary-card .value');
  if (cards.length < 4) return;

  const iosDL = data.reduce((sum, r) => sum + (parseInt(r.ios_dl) || 0), 0);
  const androidDL = data.reduce((sum, r) => sum + (parseInt(r.android_dl) || 0), 0);

  const pwTrials = data.map(r => parseFloat(r.pw_trial) || 0);
  const avgPwTrial = pwTrials.length ? (pwTrials.reduce((a,b) => a+b, 0) / pwTrials.length).toFixed(1) : 0;

  const totalRevenue = data.reduce((sum, r) => {
    const val = parseFloat(r.revenue.replace('‚Ç¨','').replace(',','.')) || 0;
    return sum + val;
  }, 0);

  cards[0].textContent = iosDL;
  cards[1].textContent = androidDL;
  cards[2].textContent = avgPwTrial + '%';
  cards[3].textContent = '‚Ç¨' + totalRevenue.toFixed(2);

  // Update labels with count
  const labels = document.querySelectorAll('.summary-card .label');
  if (labels.length >= 4) {
    labels[0].textContent = `Downloads iOS (${data.length}j)`;
    labels[1].textContent = `Downloads Android (${data.length}j)`;
    labels[2].textContent = `PW‚ÜíTrial moyen`;
    labels[3].textContent = `Revenue total (${data.length}j)`;
  }
}
</script>
</body>
</html>
